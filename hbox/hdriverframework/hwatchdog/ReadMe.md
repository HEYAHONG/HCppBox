# hwatchdog

本组件通常用于辅助实现看门狗,包括软件实现的看门狗及硬件看门狗喂狗。

需要使用看门狗时需要使用`HWATCHDOG_ADD_WATCH(check,timeout_ms,usr)`在需要检查的地方添加看门狗检查,当看门狗喂狗被调用时将执行检查函数。

喂狗操作通过调用`HWATCHDOG_FEED()`完成。

当本组件用于RTOS时,一般在RTOS的空闲线程中空闲钩子(若有)调用喂狗。

当本组件用于通用编程(如Windows、Linux等操作系统下的编程)时,一般需要单独开一个线程喂狗。

当本组件用于无操作系统时，一般需要在主循环中周期喂狗。

## 软件看门狗

软件看门狗由纯软件实现,其原理为在用户喂狗时进行检查,当检查不过时,调用特定函数。对于软件看门狗而言,需要实现以下函数并通过`hwatchdog_setup_software_dog`设置看门狗:

|              函数              |                             说明                             |
| :----------------------------: | :----------------------------------------------------------: |
|        void sys_reset()        | 系统复位。对于单片机而言为单片机软件复位，对于一般应用而言为重启自身。当此函数无效时必须实现硬件看门狗。 |
| hwatchdog_tick_t sys_tick_ms() | 获取系统时钟节拍(单位:ms)。此函数必须实现，否则看门狗将不可用。注意:返回值位宽由宏定义决定，默认为hdefaults组件的hdefaults_tick_t类型。 |

## 硬件看门狗

软件看门狗的缺点为当用户因异常不能喂狗时看门狗将失效。使用硬件看门狗可弥补软件看门狗的不足。

对于硬件看门狗的初始化，由其它代码实现。如需启用硬件看门狗,需要实现以下函数并`hwatchdog_set_hardware_dog_feed`设置喂狗函数:

|      函数      |                         说明                          |
| :------------: | :---------------------------------------------------: |
| void hw_feed() | 硬件看门狗喂狗。注意:硬件看门狗初始化由其它代码实现。 |

## 看门狗使用

可使用以下方式使用:

- 在需要添加检查的地方添加检查宏定义，一般配合lambda表达式使用。
- 使用软狗(softdog),软狗拥有与硬件看门狗相似的特性，软狗各自独立,软狗需要执行自己的喂狗(除开总的看门狗喂狗)。

