# 说明

本组件主要用于事件处理。

# 组件

##  heventloop

本组件用于辅助实现事件循环功能，通常用于将一些事件发送到其它线程执行。

通常用法为在某个固定的线程或者位置周期调用事件处理函数,在其它位置添加事件。

当所有的事件均在固定位置处理(如仅在某一个线程处理对某类资源的访问，其它线程均通过添加事件的方式访问)时，可减少多个线程需同步时锁的使用。

可外部配置的宏定义如下:

|            宏定义            |     说明     |          备注          |
| :--------------------------: | :----------: | :--------------------: |
| `HEVENTLOOP_USER_LOOP_COUNT` | 用户循环个数 | 此宏定义只影响内部的表 |
|     `HEVENTLOOP_NO_SLIM`     |  不进行精简  |       默认不定义       |

内置的表中除了用户循环之外，还包括系统循环,说明如下：

|                名称                |              说明              |                             备注                             |
| :--------------------------------: | :----------------------------: | :----------------------------------------------------------: |
| `HEVENTLOOP_SYSTEM_LOOP_WORKQUEUE` | 工作队列，用于处理不紧急的工作 | 默认在`hcpprt`中使用，若未启用c++,则用户需要在合适时机处理事件。若启用了看门狗，需注意看门狗超时时间。 |

## heventslots

本组件通常用于实现一般回调函数功能。本组件主要定义以下语义:

- 信号:调用回调函数的参数。
- 槽:回调函数
- 发送信号:使用信号作为参数依次调用回调函数。

通常回调函数可由函数指针(及其数组)简易实现，函数指针(及其数组)优点是简单可靠，缺点是不能动态添加(非设置指针),其数量是固定的。

本组件的特点为可动态注册/反注册槽。

可外部配置的宏定义如下:

|             宏定义             |    说明    |          备注          |
| :----------------------------: | :--------: | :--------------------: |
| `HEVENTSLOTS_USER_SLOTS_COUNT` | 用户槽个数 | 此宏定义只影响内部的表 |
|     `HEVENTSLOTS_NO_SLIM`      | 不进行精简 |       默认不定义       |

内置的表中除了用户槽之外，还包括系统槽,说明如下：

|              名称               |    说明    |                             备注                             |
| :-----------------------------: | :--------: | :----------------------------------------------------------: |
| `HEVENTSLOTS_SYSTEM_SLOTS_INIT` | 系统初始化 | 默认在`hcpprt`中使用，若未启用c++,则用户需要在系统初始化完成后自行向此槽发送信号 |
| `HEVENTSLOTS_SYSTEM_SLOTS_LOOP` |  系统循环  | 默认在`hcpprt`中使用，若未启用c++,则用户需要在系统循环（主循环/空闲任务）自行向此槽发送信号 |

## heventchain

本组件通常用于实现Hook回调函数功能。

本组件中回调函数是链式的,当排在前面的回调函数成功处理后将不再向后传递,如同windows的钩子一样，优先级较高的钩子可截断某些操作。

本组件相对于heventslots的特点为调用者可获取参数是否最终处理，并支持优先级(优先级高的钩子可截断数据的处理)。

可外部配置的宏定义如下:

|             宏定义             |    说明    |          备注          |
| :----------------------------: | :--------: | :--------------------: |
| `HEVENTCHAIN_USER_CHAIN_COUNT` | 用户链个数 | 此宏定义只影响内部的表 |
|     `HEVENTCHAIN_NO_SLIM`      | 不进行精简 |       默认不定义       |